<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Labubuy Admin Login</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        /* Specific styles for the admin login page */
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            text-align: center;
        }

        #google-sign-in-button {
            display: inline-block;
            background-color: #4285F4; /* Google blue */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            text-decoration: none; /* If using an anchor tag */
            transition: background-color 0.3s ease; /* Added transition */
        }

        #google-sign-in-button:hover {
            background-color: #357ae8;
        }

        #login-status {
            margin-top: 20px;
            font-weight: bold;
            color: #333; /* Default text color */
        }
         #login-status.error {
            color: #dc3545; /* Red color for errors */
         }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <h1>Labubuy</h1>
        </div>
        <div class="header-right">
            <button id="signin-icon-btn" title="Sign In" style="background:none;border:none;cursor:pointer;vertical-align:middle;" onclick="window.location.href='signin.html'">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="8" r="4" stroke="#222" stroke-width="2"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4" stroke="#222" stroke-width="2" fill="none"/></svg>
            </button>
            <button id="cart-icon-btn" title="Cart" style="background:none;border:none;cursor:pointer;vertical-align:middle;position:relative;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6h15l-1.5 9h-13z" stroke="#222" stroke-width="2" fill="none"/><circle cx="9" cy="21" r="1" stroke="#222" stroke-width="2"/><circle cx="18" cy="21" r="1" stroke="#222" stroke-width="2"/></svg>
                <span id="cart-count" style="position:absolute;top:0;right:0;background:#e74c3c;color:#fff;border-radius:50%;font-size:0.7em;padding:2px 5px;display:none;">0</span>
            </button>
        </div>
    </header>
     <nav>
        <ul>
            <li><a href="index.html">HOME</a></li>
            <li><a href="shop.html">SHOP</a></li>
            <li><a href="instructions.html">INSTRUCTIONS</a></li>
            <li><a href="about.html">About Labubuy</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="admin.html">Admin</a></li>
            <li><a href="orders.html">Orders</a></li>
        </ul>
    </nav>
    <div class="container">
        <div class="login-container">
            <h2>Admin Login</h2>
            <p>Sign in with your authorized Google account.</p>

            <button id="google-sign-in-button">Sign in with Google</button>

            <div id="login-status"></div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Labubuy. All rights reserved.</p>
        <p>Powered by Static HTML & Vercel</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore-compat.js"></script>


    <script>
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAHgPtlNvBvSgzi8R-C6v9-FBh6vcNxBX4",
            authDomain: "labubuy.firebaseapp.com",
            projectId: "labubuy",
            storageBucket: "labubuy.firebasestorage.app",
            messagingSenderId: "444655424305",
            appId: "1:444655424305:web:13d057b3014cef994a1610",
            measurementId: "G-5XQQD6J93L" // Measurement ID is optional for basic use
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore(); // Initialize Firestore

        // Define the two allowed email addresses
        const allowedEmails = ["bigjaguar20112@gmail.com", "rachanon232010@gmail.com"]; // Updated with user's emails

        // Get elements
        const signInButton = document.getElementById('google-sign-in-button');
        const loginStatus = document.getElementById('login-status');

        // Google Sign-in handler
        signInButton.addEventListener('click', () => {
            const provider = new firebase.auth.GoogleAuthProvider();
            // Optional: Force account selection
            provider.setCustomParameters({
                prompt: 'select_account'
            });
            auth.signInWithPopup(provider)
                .then((result) => {
                    // This gives you a Google Access Token. You can use it to access Google APIs.
                    const credential = firebase.auth.GoogleAuthProvider.credentialFromResult(result);
                    const token = credential.accessToken;
                    // The signed-in user info.
                    const user = result.user;

                    checkAuthorization(user);

                }).catch((error) => {
                    // Handle Errors here.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // The email of the user's account used.
                    const email = error.email;
                    // The AuthCredential type that was used.
                    const credential = firebase.auth.GoogleAuthProvider.credentialFromError(error);

                    console.error("Sign-in error:", errorMessage);
                    loginStatus.textContent = `Error: ${errorMessage}`;
                    loginStatus.classList.add('error'); // Add error class for styling
                });
        });

        // Check user authorization
        function checkAuthorization(user) {
            if (user) {
                const userEmail = user.email;
                if (allowedEmails.includes(userEmail)) {
                    loginStatus.textContent = `Signed in as ${userEmail}. Redirecting to control panel...`;
                    loginStatus.classList.remove('error'); // Remove error class
                    // User is authorized, redirect to the main control panel page
                    window.location.href = 'manage-listings.html';
                } else {
                    // User is signed in but not authorized
                    loginStatus.textContent = `Access denied for ${userEmail}.`;
                    loginStatus.classList.add('error'); // Add error class
                    auth.signOut(); // Sign out the unauthorized user
                }
            } else {
                // No user is signed in.
                loginStatus.textContent = 'Please sign in.';
                 loginStatus.classList.remove('error'); // Remove error class
            }
        }

        // Check auth state on page load
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in. Check authorization immediately.
                checkAuthorization(user);
            } else {
                // User is signed out.
                loginStatus.textContent = 'Please sign in.';
                 loginStatus.classList.remove('error'); // Remove error class
            }
        });

    </script>
    <div class="cart-container" id="cart-container">
      <div class="cart-header">
        <span class="cart-title">Your Cart</span>
        <button class="cart-close-btn" id="cart-close-btn" title="Close Cart">&times;</button>
      </div>
      <div class="cart-items" id="cart-items"></div>
      <div class="cart-total" id="cart-total"></div>
      <div class="cart-actions">
        <button class="cart-checkout-btn" id="cart-checkout-btn">Checkout</button>
      </div>
      <div class="cart-empty" id="cart-empty" style="display:none;">Your cart is empty.</div>
    </div>

    <script>
      // Cart Popup Logic
      const cartContainer = document.getElementById('cart-container');
      const cartItemsDiv = document.getElementById('cart-items');
      const cartTotalDiv = document.getElementById('cart-total');
      const cartEmptyDiv = document.getElementById('cart-empty');
      const cartCloseBtn = document.getElementById('cart-close-btn');
      const cartCheckoutBtn = document.getElementById('cart-checkout-btn');
      const cartCountSpan = document.getElementById('cart-count');
      let cart = JSON.parse(localStorage.getItem('labubuy_cart') || '[]');
      function saveCart() {
        localStorage.setItem('labubuy_cart', JSON.stringify(cart));
      }
      function renderCart() {
        cartItemsDiv.innerHTML = '';
        if (cart.length === 0) {
          cartEmptyDiv.style.display = 'block';
          cartTotalDiv.textContent = '';
          cartCheckoutBtn.disabled = true;
        } else {
          cartEmptyDiv.style.display = 'none';
          let total = 0;
          cart.forEach((item, idx) => {
            total += parseFloat(item.price.replace(/[^\d.]/g, '')) || 0;
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
              <img src="${item.imageUrl}" alt="${item.name}">
              <div class="cart-item-details">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-price">${item.price}</div>
              </div>
              <button class="cart-item-remove" title="Remove" data-idx="${idx}">&times;</button>
            `;
            cartItemsDiv.appendChild(cartItem);
          });
          cartTotalDiv.textContent = 'Total: $' + total.toFixed(2);
          cartCheckoutBtn.disabled = false;
        }
        cartCountSpan.textContent = cart.length;
        cartCountSpan.style.display = cart.length > 0 ? 'inline-block' : 'none';
      }
      document.getElementById('cart-icon-btn').onclick = function() {
        cartContainer.classList.toggle('active');
      };
      cartCloseBtn.onclick = function() {
        cartContainer.classList.remove('active');
      };
      cartItemsDiv.onclick = function(e) {
        if (e.target.classList.contains('cart-item-remove')) {
          const idx = parseInt(e.target.getAttribute('data-idx'));
          cart.splice(idx, 1);
          saveCart();
          renderCart();
        }
      };
      cartCheckoutBtn.onclick = function() {
        alert('Thank you for shopping with Labubuy! Please follow the instructions for cash payment.');
        cart = [];
        saveCart();
        renderCart();
        cartContainer.classList.remove('active');
      };
      renderCart();
    </script>
</body>
</html>
